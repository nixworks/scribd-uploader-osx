<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
	"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
	<head>
		<title>Scribd Uploader source code overview</title>
		<meta name="keywords" content="source code, developer" />
		<meta name="project" content="Scribd Uploader Help" />
		<meta name="description" content="An overview of the Scribd Uploader codebase." />
    <link href="../sty/layout.css" rel="stylesheet" type="text/css" />
    <link href="../sty/typography.css" rel="stylesheet" type="text/css" />
    <link href="../sty/print.css" rel="stylesheet" type="text/css" media="print" />
	</head>

	<body class="en">
		<div id="Nav">
			<a id="code_overview" />
			<div id="NavLeft"><a class="NavLinkLeft" href="help:anchor='access' bookID=Scribd Uploader Help">Home</a></div>
			<!-- div id="NavRight"><a class="NavLinkRight" href="help:anchor='index' bookID=Scribd Uploader Help">Index</a></div -->
		</div>
		
		<div class="AppleTopic">
			<div class="Section">
				<div id="Header">
					<div id="Icon"><img id="iconimg" src="../gfx/icon32.png" alt="Scribd Uploader icon" height="32" width="32" /></div>
					<div class="Name">Scribd Uploader source code overview</div>
				</div>
				<div class="AppleTopicBody">
					<div class="Intro">
						<p class="Para">Scribd Uploader for Mac OS X is a fully Cocoa-native application developed in Objective-C. Scribd Uploader uses the following Cocoa technologies:</p>
						<ul class="ListDescriptor">
							<li>
								<div class="Term">Core Data:  </div>
								<div class="Description">The upload queue is stored using the Core Data API. Each file in the queue is an <span class="CodeBody">NSManagedObject</span> entity.</div>
							</li>
							<li>
								<div class="Term">Cocoa Bindings:  </div>
								<div class="Description">Model objects are all Key-Value Coding compliant, and view controls almost always have their attributes set via Cocoa Bindings.</div>
							</li>
							<li>
								<div class="Term">Drag and Drop:  </div>
								<div class="Description">The file list view has been subclassed to add Cocoa drag-and-drop support for adding files.</div>
							</li>
							<li>
								<div class="Term">Quick Look:  </div>
								<div class="Description">Though the Quick Look API is unpublished and undocumented by Apple, Scribd Uploader makes use of it to integrate Quick Look support in the file list.</div>
							</li>
						</ul>
						<p class="Para">To communicate with the Scribd website, Scribd Uploader uses the <a href="http://www.scribd.com/publisher/api">Scribd Platform API</a>. This API allows any program or library to work with the Scribd website. A program can create accounts, log in, upload and modify files, and more using standard HTTP calls.</p>
						<p class="Para">Scribd Uploader uses <a href="http://allseeing-i.com/ASIHTTPRequest">ASIHTTPRequest</a> to send and receive data from the Scribd.com website. <span class="CodeBody">ASIHTTPRequest</span> is an improvement upon <span class="CodeBody">NSHTTPRequest</span> that better supports <span class="CodeBody">POST</span>ing large form data fields.</p>
						<p class="Para">To perform automatic updates, Scribd uses <a href="http://sparkle.andymatuschak.org/">Sparkle</a>. Be aware that Sparkle&rsquo;s classes use the same prefix as the Scribd Uploader (&ldquo;SU&rdquo;), which can lead to confusion. The preferences window is handled by <a href="http://www.mere-mortal-software.com/blog/details.php?d=2007-03-11">DBPreferencesWindow</a>.</p>
						<p class="Para">Scribd also includes the <a href="http://growl.info/">Growl</a> framework for background notification.</p>
						<p class="Para">Scribd uses <a href="http://extendmac.com/EMKeychain/">EMKeychain</a> as a Cocoa proxy to the Keychain Manager.</p>
						
						<h2>Documentation</h2>
						<p class="Para">All public classes and methods in the Scribd Uploader codebase are documented comprehensively using the <a href="http://developer.apple.com/opensource/tools/headerdoc.html">HeaderDoc</a> format. The best way to understand a class's purpose and functionality is to read its &ldquo;.h&rdquo; file, which contains HeaderDoc documentation for the class and its public methods. Documentation for private methods or overridden methods, should you need it, is available in the &ldquo;.m&rdquo; file for the class, in basic C block comment syntax.</p>
						
						<h2>Descriptive Overview</h2>
						<p class="Para">The first responder for most application events is <span class="CodeBody"><span class="CodeUnderline">SUAppDelegate</span></span>. This class handles button-click events for the primary user interface buttons. If a file is added using the Add File&hellip; button, the <span class="CodeBody">addFile:</span> method is called. Drag-and-drop adding of files, however, is handled by the <span class="CodeBody"><span class="CodeUnderline">SUDocumentArrayController</span></span> class. This subclass of <span class="CodeBody">NSArrayController</span> is the drag-and-drop delegate for the file list view.</p>
						<p class="Para">Files in the queue are <span class="CodeBody"><span class="CodeUnderline">SUDocument</span></span> Core Data entities. Core Data objects (the managed object context and model, for instance) are accessible via the <span class="CodeBody"><span class="CodeUnderline">SUDatabaseHelper</span></span> nib object. When the application first starts, <span class="CodeBody">SUDatabaseHelper</span> checks if any files in the queue have been moved or deleted since the last launch. If so, it then removes those files from the queue and displays an alert using <span class="CodeBody"><span class="CodeUnderline">SUFileNotFoundAlertDelegate</span></span>.</p>
						<p class="Para">When a document&rsquo;s title is changed, the <span class="CodeBody">SUDocument</span> class adds a <span class="CodeBody"><span class="CodeUnderline">SUTitleCleanerOperation</span></span> to its title cleaning queue (a static object). This operation uses <span class="CodeBody">SUScribdAPI</span> to apply a new, cleaner title to the file.</p>
						<p class="Para">The file list view is a subclassed <span class="CodeBody">NSScrollView</span> called <span class="CodeBody"><span class="CodeUnderline">SUFileListView</span></span>. The subclass listens for space bar keypress events and displays the Quick Look pane. Quick Look is handled by the <span class="CodeBody"><span class="CodeUnderline">SUQuickLookDelegate</span></span>.</p>
						<p class="Para">The Information drawer is handled by <span class="CodeBody"><span class="CodeUnderline">SUInformationDrawerDelegate</span></span>, which also acts as a delegate for the Tags token field. Tags are loaded from Scribd.com as each new key is pressed using <span class="CodeBody">SUScribdAPI</span>. Categories are loaded from Scribd.com every two weeks (also using <span class="CodeBody">SUScribdAPI</span>) and stored in the persistent store as elements of the <span class="CodeBody">SUCategory</span> managed object model.</p>
						<p class="Para">The Publisher panel is handled by the <span class="CodeBody"><span class="CodeUnderline">SUPublisherPanelDelegate</span></span>, which responds to actions originating from the panel.</p>
						<p class="Para">If the user presses the Log In/Switch Users button (or if he presses the Upload button without first having logged in), the login/signup pane is shown. This pane's events are processed by the <span class="CodeBody"><span class="CodeUnderline">SULoginSheetDelegate</span></span>. This delegate receives Log In or Sign Up button clicks, performs the action, and handles the user interface response for the result (whether successful or not).</p>
						<p class="Para">The login sheet delegate does this by making calls to <span class="CodeBody"><span class="CodeUnderline">SUUploadHelper</span></span>, which performs signup, login, and upload tasks using information in the view. The actual HTTP calls to the Scribd.com website are performed by <span class="CodeBody"><span class="CodeUnderline">SUScribdAPI</span></span>. If the API returns an error, the <span class="CodeBody"><span class="CodeUnderline">SUAdditions</span></span> category adds a method to <span class="CodeBody">NSError</span> which populates it with API error information.</p>
						<p class="Para">Information about the Scribd.com API, such as method names, URL&rsquo;s, and error number meanings, are stored in the <span class="CodeBody">ScribdAPI.plist</span> file, which is accessed using the <span class="CodeBody"><span class="CodeUnderline">SUAPIHelper</span></span> class.</p>
						<p class="Para">If a login is successful, the <span class="CodeBody"><span class="CodeUnderline">SUSessionHelper</span></span> singleton stores the Scribd.com session key in the Keychain, so that the login step can be skipped for future uploads.</p>
						<p class="Para">When the upload is underway, <span class="CodeBody">SUUploadHelper</span> creates a <span class="CodeBody"><span class="CodeUnderline">SUUploadDelegate</span></span> instance for each file that is being uploaded. This delegate responds to <span class="CodeBody">ASIHTTPRequest</span> events, updating the <span class="CodeBody">SUDocument</span>'s attributes (which are bound to view objects). If an error occurs, the upload delegate serializes the <span class="CodeBody">NSError</span> and stores it in the <span class="CodeBody">SUDocument</span> entity's <span class="CodeBody">error</span> property.</p>
						<p class="Para">Files that error have small error widgets displayed next to them. These widgets are <span class="CodeBody">NSButton</span>s that, when clicked, use <span class="CodeBody"><span class="CodeUnderline">SUUploadErrorController</span></span> to display a sheet with information about the error. To facilitate binding the icon for this button to the error state for the file, the table column is subclassed as <span class="CodeBody"><span class="CodeUnderline">SUTableStatusColumn</span></span>.</p>
						<p class="Para">When a batch upload is complete, a sheet is displayed giving the user a chance to visit the Scribd.com website and edit the newly uploaded documents. This sheet&rsquo;s events are handled by <span class="CodeBody"><span class="CodeUnderline">SUUploadCompleteSheetDelegate</span></span>, which builds the Scribd.com URL to visit, among other tasks.</p>
						<p class="Para">The About window also has its own delegate, mainly for showing a relevant help page when the &ldquo;?&rdquo; button is clicked; it is <span class="CodeBody"><span class="CodeUnderline">SUAboutWindowDelegate</span></span>.</p>
						<p class="Para">The Preferences window is defined and managed in a separate xib file, Preferences.xib, whose owner is a nib-instanced <span class="CodeBody"><span class="CodeUnderline">SUPreferencesWindowController</span></span>, which handles events from the Preferences window.</p>
						<p class="Para">File scanning is performed by <span class="CodeBody"><span class="CodeUnderline">SUDirectoryScanner</span></span>, which has its own operation queue (actually a <span class="CodeBody">SUDeferredOperationQueue</span>, a subclass that does not start its operations immediately) to which <strong><span class="CodeBody">SUDirectoryScanOperation</span>s</strong> are added. The file scanner posts notifications when scanning starts and ends, and the app delegate responds to these notifications by showing and hiding the file scan sheet.</p>
						<p class="Para">The <span class="CodeBody"><span class="CodeUnderline">SUAddURLWindowDelegate</span></span> class receives events from the Add URL window, adding URL&rsquo;s to the queue when the Add URL is clicked.</p>
						
						<table type="Multicolumn" cols="2" border="0" cellspacing="2" cellpadding="2">
							<tr class="TableHead">
								<th>
									<div class="TableHead">To learn about</div>
								</th>
								<th>
									<div class="TableHead">Go to</div>
								</th>
							</tr>
							<tr>
								<td>
									<p class="Para">How to contribute to the Scribd Uploader project</p>
								</td>
								<td>
									<p class="Para"><a href="help:anchor='edit_code' bookID=Scribd Uploader Help">Add to or modify the code for Scribd Uploader</a></p>
									<p class="Para"><a href="help:anchor='redistribution_license' bookID=Scribd Uploader Help">View the license for redistributing modified copies of Scribd Uploader</a></p>
								</td>
							</tr>
							<tr>
								<td>
									<p class="Para">How to deploy new versions of Scribd Uploader</p>
								</td>
								<td>
									<p class="Para"><a href="help:anchor='deployment' bookID=Scribd Uploader Help">Deploying new versions of Scribd Uploader</a></p>
								</td>
							</tr>
							<tr>
								<td>
									<p class="Para">The Scribd Uploader project home page</p>
								</td>
								<td>
									<p class="Para"><a href="http://github.com/RISCfuture/scribd-uploader">Scribd Uploader developer project site</a></p>
								</td>
							</tr>
						</table>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>
